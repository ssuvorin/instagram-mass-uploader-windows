{% extends "uploader/base.html" %}

{% block title %}Import UA+Cookies - Instagram Uploader{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<div>
		<a href="{% url 'account_list' %}" class="text-decoration-none">
			<i class="bi bi-arrow-left"></i> Back to Accounts
		</a>
		<h2 class="mb-0 mt-2">Import UA+Cookies</h2>
		<p class="text-muted mb-0">Format: <code>username:password|UA|cookies</code> or <code>username:password|UA|device_info|cookies</code></p>
	</div>
</div>

<div class="row">
	<div class="col-lg-8 mx-auto">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0"><i class="bi bi-file-earmark-arrow-up"></i> Upload UA+Cookies File</h5>
			</div>
			<div class="card-body">
				<div class="alert alert-info">
					<div class="d-flex">
						<div class="me-3">
							<i class="bi bi-info-circle-fill fs-3"></i>
						</div>
						<div>
							<h6 class="alert-heading">Expected Format</h6>
							<p class="mb-2">Each line in one of the following forms:</p>
							<ul class="mb-2">
								<li><code>username:password|UA|cookie1=value1; cookie2=value2; ...</code></li>
								<li><code>username:password|UA|android-&lt;device&gt;;phone_id;uuid;client_session_id|cookie1=value1; ...</code></li>
							</ul>
							<p class="small mb-0">All cookies are treated as WEB cookies and will be imported into the created Dolphin profile.</p>
						</div>
					</div>
				</div>

				<form method="post" enctype="multipart/form-data" class="mt-3">
					{% csrf_token %}
					<div class="mb-4">
						<label for="client_id" class="form-label">Assign to Client (optional)</label>
						<select class="form-select" id="client_id" name="client_id">
							<option value="">— Without client —</option>
							{% for c in clients %}
								<option value="{{ c.id }}">{{ c.name }} {% if c.agency %}(Agency: {{ c.agency.name }}){% endif %}</option>
							{% endfor %}
						</select>
						<div class="form-text">Привязать импортируемые аккаунты к выбранному клиенту.</div>
					</div>


					<div class="mb-4">
						<label for="accounts_file" class="form-label">UA+Cookies File</label>
						<input type="file" name="accounts_file" id="accounts_file" class="form-control" accept=".txt" required>
						<div class="form-text">Select a text file with accounts in UA+Cookies format</div>
					</div>

					<div class="mb-4">
						<label for="profile_locale" class="form-label">Dolphin Profile Locale</label>
						<select class="form-select" id="profile_locale" name="profile_locale">
							<option value="ru_BY" selected>ru_BY (Русский интерфейс, регион BY)</option>
							<option value="en_IN">en_IN (English interface, India)</option>
							<option value="es_CL">es_CL (Español, Chile)</option>
							<option value="es_MX">es_MX (Español, México)</option>
							<option value="pt_BR">pt_BR (Português, Brasil)</option>
						</select>
						<div class="form-text">Локаль профиля Dolphin. Используется для Accept-Language/TZ/Гео.</div>
					</div>

					<div class="mb-4">
						<label for="proxy_selection" class="form-label">Proxy Selection</label>
						<select class="form-select" id="proxy_selection" name="proxy_selection">
							<option value="locale_only" selected>Привязывать прокси к выбранной локации (по стране локали)</option>
							<option value="any">Любые свободные прокси</option>
						</select>
						<div class="form-text">Выберите, подбирать ли прокси строго под локаль (страна выбранной локали) или из любых свободных при импорте.</div>
					</div>

					<div class="form-check mb-4">
						<input class="form-check-input" type="checkbox" value="1" id="proxy_locale_strict" name="proxy_locale_strict">
						<label class="form-check-label" for="proxy_locale_strict">
							Только страна локали (если не хватает подходящих прокси — прервать импорт)
						</label>
					</div>

					<div class="mb-4">
						<label for="profile_mode" class="form-label">Profile Mode</label>
						<select class="form-select" id="profile_mode" name="profile_mode">
							<option value="create_profiles" selected>Создавать Dolphin веб‑профили</option>
							<option value="api_only">Только через API (без профилей)</option>
						</select>
						<div class="form-text">В режиме API‑only Dolphin профили не создаются, cookies не импортируются в них.</div>
					</div>

					<div class="d-grid gap-2">
						<button type="submit" class="btn btn-primary" id="submitBtn">
							<i class="bi bi-cloud-upload"></i> Import
						</button>
						<a href="{% url 'account_list' %}" class="btn btn-outline-secondary">
							<i class="bi bi-x"></i> Cancel
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
{% endblock %} 