{% extends "uploader/base.html" %}

{% block title %}Import Account Bundle - Instagram Uploader{% endblock %}

{% block extra_css %}
<style>
	.bundle-example { white-space: pre-wrap; overflow-wrap: anywhere; word-break: break-word; }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<div>
		<a href="{% url 'account_list' %}" class="text-decoration-none">
			<i class="bi bi-arrow-left"></i> Back to Accounts
		</a>
		<h2 class="mb-0 mt-2">Import Account Bundle</h2>
        <p class="text-muted mb-0">Форматы (1 строка на аккаунт, секции через <code>|</code>):</p>
        <ul class="text-muted small mb-0">
            <li><b>Новый</b>: <code>username:pass:email:email_pass | user_agent | proxy | ip | locale</code></li>
            <li><b>Прокси</b>: <code>user:pass@host:port</code> или <code>http:host:port:user:pass</code> или <code>host:port:user:pass</code></li>
            <li><b>Locale</b>: <code>es-CL</code> или <code>es_CL</code> (нормализуется)</li>
            <li><b>Legacy</b> (поддерживается): <code>creds | UA | device_ids | cookies/headers | proxy</code></li>
        </ul>
	</div>
</div>

<div class="row">
	<div class="col-lg-10 mx-auto">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0"><i class="bi bi-file-earmark-arrow-up"></i> Upload Bundle File</h5>
			</div>
			<div class="card-body">
				<div class="alert alert-info">
					<div class="d-flex">
						<div class="me-3">
							<i class="bi bi-info-circle-fill fs-3"></i>
						</div>
						<div>
							<h6 class="alert-heading">Expected Format</h6>
                            <p class="mb-2">Примеры:</p>
                            <pre class="small bg-light p-2 rounded overflow-auto bundle-example">login:pass:email:emailpass | Instagram 400.0.0.27.75 (iPhone...) | proxyuser:proxypass@93.190.141.105:9999 | 186.40.219.32 | es-CL
login:pass | Instagram 269.0.0.18.75 Android (29/10; 640dpi; 1440x3040; samsung; SM-G973F; beyond1; exynos9820) | http:190.2.142.241:9999:proxy:pass | 186.189.71.110 | es_CL
login:pass:email:emailpass|Instagram 364.0.0.18.86 Android (...)|android-xxx;device_guid;phone_id;ad_id|Authorization=Bearer IGT:2:...; IG-U-DS-USER-ID=...; X-MID=...; ...|https:host:10000:proxyuser:proxypass</pre>

                            <ul class="mb-0">
                                <li><b>Creds</b>: <code>login:password[:email][:email_password]</code></li>
                                <li><b>User-Agent</b>: Instagram мобильный UA (строго сохраняется для instagrapi)</li>
                                <li><b>Proxy</b>: поддерживаются все распространённые формы</li>
                                <li><b>IP</b>: внешний IP прокси (опционально)</li>
                                <li><b>Locale</b>: например, <code>es-CL</code>; влияет на гео в instagrapi</li>
                                <li><b>Legacy</b>: можно указать cookies/headers и device ids — будут импортированы</li>
                            </ul>
						</div>
					</div>
				</div>

				<form method="post" enctype="multipart/form-data" class="mt-3">
					{% csrf_token %}
					<div class="mb-4">
						<label for="client_id" class="form-label">Assign to Client (optional)</label>
						<select class="form-select" id="client_id" name="client_id">
							<option value="">— Without client —</option>
							{% for c in clients %}
								<option value="{{ c.id }}">{{ c.name }} {% if c.agency %}(Agency: {{ c.agency.name }}){% endif %}</option>
							{% endfor %}
						</select>
						<div class="form-text">Импортируемые аккаунты будут привязаны к выбранному клиенту.</div>
					</div>
					<div class="mb-4">
						<label for="accounts_file" class="form-label">Bundle File</label>
						<input type="file" name="accounts_file" id="accounts_file" class="form-control" accept=".txt" required>
						<div class="form-text">Выберите текстовый файл с одной строкой на аккаунт</div>
					</div>

					<div class="mb-4">
						<label for="profile_mode" class="form-label">Profile Mode</label>
						<select class="form-select" id="profile_mode" name="profile_mode">
							<option value="create_profiles" selected>Создавать Dolphin веб‑профили</option>
							<option value="api_only">Только через API (без профилей)</option>
						</select>
						<div class="form-text">Режим API‑only пропускает создание профилей и импорт cookies в них.</div>
					</div>

					<div class="d-grid gap-2">
						<button type="submit" class="btn btn-primary" id="submitBtn">
							<i class="bi bi-cloud-upload"></i> Import
						</button>
						<a href="{% url 'account_list' %}" class="btn btn-outline-secondary">
							<i class="bi bi-x"></i> Cancel
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
{% endblock %}


