{% extends 'uploader/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h3>Сборщик ссылок на Reels</h3>
  <p class="text-muted">Загрузите файл со ссылками на аккаунты Instagram и получите список ссылок на все опубликованные reels</p>
  
  <form method="post" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
      <label for="account_id" class="form-label">Аккаунт для аутентификации</label>
      <select name="account_id" id="account_id" class="form-select" required>
        <option value="">Выберите аккаунт</option>
        {% for acc in accounts %}
          <option value="{{ acc.id }}" {% if form_account_id == acc.id|stringformat:'s' %}selected{% endif %}>
            {{ acc.username }} {% if acc.status %}({{ acc.status }}){% endif %}
          </option>
        {% endfor %}
      </select>
      <small class="form-text text-muted">Выберите аккаунт из системы для аутентификации в Instagram</small>
    </div>
    
    <div class="mb-3">
      <label for="accounts_file" class="form-label">Файл со ссылками на аккаунты</label>
      <input type="file" name="accounts_file" id="accounts_file" class="form-control" accept=".txt" required />
      <small class="form-text text-muted">
        Загрузите .txt файл, где каждая строка содержит ссылку на аккаунт Instagram или username.<br>
        Формат: одна ссылка/username на строку<br>
        Примеры:<br>
        • https://instagram.com/username<br>
        • https://www.instagram.com/username<br>
        • username<br>
        • @username
      </small>
    </div>
    
    <div class="mb-3">
      <label for="max_reels_per_account" class="form-label">Максимум reels на аккаунт</label>
      <input type="number" name="max_reels_per_account" id="max_reels_per_account" class="form-control" value="0" min="0" />
      <small class="form-text text-muted">
        0 = собрать все reels (по умолчанию). Укажите число, чтобы ограничить количество reels на аккаунт.
      </small>
    </div>
    
    <div class="mb-3">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="fast_mode" id="fast_mode" />
        <label class="form-check-label" for="fast_mode">
          <strong>⚡ Быстрый режим</strong> (минимальные задержки для ускорения сбора)
        </label>
        <small class="form-text text-muted d-block">
          Внимание: быстрый режим снижает защиту от блокировки аккаунта. Используйте только если нужно собрать данные быстро.
          Задержки: 0.3-0.8 сек вместо 1.5-4.5 сек.
        </small>
      </div>
    </div>
    
    <button class="btn btn-primary" type="submit">
      <i class="bi bi-collection-play me-2"></i>Начать сбор reels
    </button>
    <a href="{% url 'dashboard' %}" class="btn btn-secondary">Отмена</a>
  </form>

  {% if logs %}
  <div class="mt-4">
    <h5>Логи</h5>
    <pre class="bg-light p-3" style="max-height: 300px; overflow:auto;">{% for l in logs %}{{ l }}
{% endfor %}</pre>
  </div>
  {% endif %}
</div>
{% endblock %}

