{% extends 'uploader/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  {% if task_started %}
  <div class="alert alert-info mt-3">
    <h5><i class="bi bi-clock-history me-2"></i>–°–±–æ—Ä –∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</h5>
    <p class="mb-2">
      –ó–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç <strong>{{ total_accounts }}</strong> –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ.
      {% if fast_mode %}
      <span class="badge bg-warning">‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω</span>
      {% endif %}
    </p>
    <p class="mb-0">
      –°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—ã–≤–æ–¥–æ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
      –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –º–µ—Ä–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤.
    </p>
  </div>
  {% endif %}

  <h3>{% if task_started %}–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ{% else %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∞ Reels{% endif %}</h3>

  <div class="row mt-3">
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">{% if task_started %}–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏{% else %}–°–≤–æ–¥–∫–∞{% endif %}</h5>
          <ul class="list-group list-group-flush">
            {% if task_started %}
            <li class="list-group-item">
              –í—Å–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ: <strong>{{ total_accounts }}</strong>
            </li>
            <li class="list-group-item">
              –ê–∫–∫–∞—É–Ω—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: <strong>{{ selected_account.username }}</strong>
            </li>
            {% if max_reels_per_account %}
            <li class="list-group-item">
              –ú–∞–∫—Å–∏–º—É–º reels –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç: <strong>{{ max_reels_per_account }}</strong>
            </li>
            {% endif %}
            {% if fast_mode %}
            <li class="list-group-item">
              –†–µ–∂–∏–º: <strong class="text-warning">‚ö° –ë—ã—Å—Ç—Ä—ã–π</strong>
            </li>
            {% endif %}
            {% else %}
            <li class="list-group-item">
              –í—Å–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ: <strong>{{ result.total_accounts }}</strong>
            </li>
            <li class="list-group-item">
              –£—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong class="text-success">{{ result.processed_accounts }}</strong>
            </li>
            <li class="list-group-item">
              –û—à–∏–±–æ–∫: <strong class="text-danger">{{ result.failed_accounts }}</strong>
            </li>
            <li class="list-group-item">
              –í—Å–µ–≥–æ —Å–æ–±—Ä–∞–Ω–æ —Å—Å—ã–ª–æ–∫ –Ω–∞ reels: <strong class="text-primary">{{ result.total_reels_links }}</strong>
            </li>
            {% if result.max_reels_per_account %}
            <li class="list-group-item">
              –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç: <strong>{{ max_reels_per_account }} reels</strong>
            </li>
            {% endif %}
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="card-title">–§–∞–π–ª—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h5>
          {% if task_started %}
          <p class="mb-2"><strong>–§–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:</strong></p>
          <ul class="list-unstyled">
            <li class="mb-2">
              <strong>üìÅ –°—Å—ã–ª–∫–∏ –Ω–∞ reels:</strong><br>
              <code class="small">{{ output_file_path }}</code>
            </li>
            <li class="mb-2">
              <strong>üìÅ –ê–∫–∫–∞—É–Ω—Ç—ã —Å reels:</strong><br>
              <code class="small">{{ accounts_with_reels_file_path }}</code>
            </li>
          </ul>
          <div class="alert alert-warning mt-3 mb-0">
            <small>
              <i class="bi bi-info-circle me-1"></i>
              –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª—ã –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
            </small>
          </div>
          {% else %}
          <p>–ê–∫–∫–∞—É–Ω—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: <strong>{{ selected_account.username }}</strong></p>
          <p>–ê–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª–µ: <strong>{{ total_accounts }}</strong></p>
          {% if fast_mode %}
          <p class="text-warning"><strong>‚ö° –ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º –±—ã–ª –≤–∫–ª—é—á–µ–Ω</strong></p>
          {% endif %}
          {% if result.output_file_path %}
          <p class="mt-3">
            <strong>–§–∞–π–ª —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:</strong><br>
            <code>{{ result.output_file_path }}</code>
          </p>
          {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if task_started %}
  <div class="alert alert-success mt-3">
    <h5><i class="bi bi-check-circle me-2"></i>–ó–∞–¥–∞—á–∞ –∑–∞–ø—É—â–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</h5>
    <p class="mb-2">
      –°–±–æ—Ä –Ω–∞—á–∞—Ç –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –í—Å–µ —Å—Å—ã–ª–∫–∏ –±—É–¥—É—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –≤ —Ñ–∞–π–ª—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
    </p>
    <p class="mb-0">
      <strong>–°–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–æ–Ω—Å–æ–ª—å—é —Å–µ—Ä–≤–µ—Ä–∞</strong> –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
      –§–∞–π–ª—ã –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤ –ª—é–±–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ - –æ–Ω–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤.
    </p>
  </div>
  {% elif result.output_file_path %}
  <div class="alert alert-success mt-3">
    <h5><i class="bi bi-check-circle me-2"></i>–°–±–æ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h5>
    <p class="mb-0">
      –°—Å—ã–ª–∫–∏ –Ω–∞ reels —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª:<br>
      <code>{{ result.output_file_path }}</code>
    </p>
  </div>
  {% endif %}

  {% if logs %}
  <div class="mt-3">
    <h5>–õ–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞</h5>
    <pre class="bg-light p-3" style="max-height: 500px; overflow:auto; font-size: 0.9em;">{% for l in logs %}{{ l }}
{% endfor %}</pre>
  </div>
  {% endif %}

  <div class="mt-3">
    <a class="btn btn-primary" href="{% url 'reels_collector' %}">
      <i class="bi bi-arrow-left me-2"></i>–ù–æ–≤—ã–π —Å–±–æ—Ä
    </a>
    <a class="btn btn-secondary" href="{% url 'dashboard' %}">
      <i class="bi bi-house me-2"></i>–ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>
  </div>
</div>
{% endblock %}

