# Requirements Document

## Introduction

Система кабинета содержит сложную логику подсчета метрик для клиентов, агентств и администраторов. Пользователи сообщают о неточностях в подсчете метрик, дублировании данных и запутанной логике. Необходимо провести полный аудит и исправить все проблемы с подсчетом метрик, чтобы обеспечить точность и прозрачность данных.

## Glossary

- **Cabinet_System**: Система кабинета для управления клиентами, агентствами и аналитикой
- **HashtagAnalytics**: Модель данных для хранения аналитики по хештегам и социальным сетям
- **AnalyticsService**: Сервис для обработки и агрегации аналитических данных
- **Client**: Клиент в системе кабинета
- **Agency**: Агентство, управляющее несколькими клиентами
- **Manual_Analytics**: Ручно введенные аналитические данные
- **Automatic_Analytics**: Автоматически собранные данные по хештегам
- **Metrics_Duplication**: Дублирование метрик при подсчете
- **Data_Aggregation**: Процесс агрегации данных из разных источников

## Requirements

### Requirement 1

**User Story:** Как администратор системы, я хочу видеть точные и непротиворечивые метрики на всех страницах кабинета, чтобы принимать правильные решения на основе данных.

#### Acceptance Criteria

1. WHEN администратор просматривает дашборд, THE Cabinet_System SHALL отображать метрики без дублирования данных
2. WHEN администратор сравнивает метрики между разными страницами, THE Cabinet_System SHALL показывать одинаковые значения для одних и тех же периодов
3. WHEN администратор экспортирует данные, THE Cabinet_System SHALL предоставлять данные, соответствующие отображаемым в интерфейсе
4. THE Cabinet_System SHALL четко разделять Manual_Analytics и Automatic_Analytics при подсчете
5. THE Cabinet_System SHALL предотвращать Metrics_Duplication при агрегации данных

### Requirement 2

**User Story:** Как владелец агентства, я хочу видеть корректные агрегированные метрики по всем моим клиентам, чтобы оценивать общую эффективность агентства.

#### Acceptance Criteria

1. WHEN владелец агентства просматривает дашборд агентства, THE Cabinet_System SHALL агрегировать метрики только по клиентам данного агентства
2. WHEN владелец агентства просматривает разбивку по клиентам, THE Cabinet_System SHALL показывать корректные индивидуальные метрики каждого клиента
3. WHEN владелец агентства просматривает временные периоды, THE Cabinet_System SHALL корректно фильтровать данные по выбранному периоду
4. THE Cabinet_System SHALL исключать дублирование при суммировании метрик клиентов
5. THE Cabinet_System SHALL корректно обрабатывать клиентов без данных

### Requirement 3

**User Story:** Как клиент, я хочу видеть точные метрики по своим социальным сетям, чтобы понимать эффективность продвижения.

#### Acceptance Criteria

1. WHEN клиент просматривает свой дашборд, THE Cabinet_System SHALL отображать метрики только по его хештегам и аккаунтам
2. WHEN клиент просматривает разбивку по социальным сетям, THE Cabinet_System SHALL корректно разделять данные по платформам
3. WHEN клиент просматривает временную динамику, THE Cabinet_System SHALL показывать корректные данные за выбранный период
4. THE Cabinet_System SHALL корректно объединять Manual_Analytics и Automatic_Analytics для клиента
5. THE Cabinet_System SHALL предотвращать двойной подсчет одних и тех же данных

### Requirement 4

**User Story:** Как разработчик системы, я хочу иметь четкую и понятную логику подсчета метрик, чтобы легко поддерживать и расширять функциональность.

#### Acceptance Criteria

1. THE Cabinet_System SHALL использовать единообразные методы Data_Aggregation во всех компонентах
2. THE Cabinet_System SHALL иметь четкое разделение ответственности между AnalyticsService и представлениями
3. THE Cabinet_System SHALL логировать процесс агрегации данных для отладки
4. THE Cabinet_System SHALL валидировать входные данные перед агрегацией
5. THE Cabinet_System SHALL иметь документированные алгоритмы подсчета каждой метрики

### Requirement 5

**User Story:** Как пользователь системы, я хочу понимать, как рассчитываются метрики, чтобы доверять отображаемым данным.

#### Acceptance Criteria

1. THE Cabinet_System SHALL предоставлять объяснения методов расчета ключевых метрик
2. WHEN пользователь наводит курсор на метрику, THE Cabinet_System SHALL показывать подсказку с формулой расчета
3. THE Cabinet_System SHALL отображать источники данных для каждой метрики
4. THE Cabinet_System SHALL показывать временные рамки для каждой метрики
5. THE Cabinet_System SHALL предупреждать о потенциальных неточностях в данных