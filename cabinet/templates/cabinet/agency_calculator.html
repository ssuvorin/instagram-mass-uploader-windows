{% extends "uploader/base.html" %}

{% block title %}ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ - Instagram Ğ¸ TikTok{% endblock %}

{% block content %}
<style>
        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #333333;
            --accent-color: #ff6b35;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --dark-color: #1a1a1a;
            --light-color: #f8f9fa;
            --text-color: #333333;
            --border-color: #e9ecef;
        }
        
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            margin: 2rem auto;
            max-width: 1400px;
        }
        
        .header-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
            min-height: 120px;
        }
        
        .header-section h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            max-width: 70%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .header-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            z-index: 10;
        }
        
        .stats-btn {
            background: var(--accent-color);
            border: 2px solid var(--accent-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stats-btn:hover {
            background: #e55a2b;
            border-color: #e55a2b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }
        
        .tariffs-section {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 2rem;
            border-radius: 15px;
            margin: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .tariffs-section h3 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .tariff-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid var(--accent-color);
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .tariff-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }
        
        .tier-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .tier-1 { background: linear-gradient(135deg, var(--accent-color), #e55a2b); color: white; }
        .tier-2 { background: linear-gradient(135deg, var(--warning-color), #e0a800); color: white; }
        .tier-3 { background: linear-gradient(135deg, var(--danger-color), #c82333); color: white; }
        .tier-difficult { background: linear-gradient(135deg, var(--dark-color), #495057); color: white; }
        
        .form-section {
            padding: 2rem;
        }
        
        .form-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .form-card h4 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid var(--border-color);
            padding: 0.75rem 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.25);
        }
        
        .form-check-input:checked {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .btn {
            border-radius: 25px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), #e55a2b);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.6);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }
        
        .result-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .final-cost {
            background: linear-gradient(135deg, var(--accent-color), #e55a2b);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
        }
        
        .accordion-button {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .accordion-button:not(.collapsed) {
            background: linear-gradient(135deg, var(--accent-color), #e55a2b);
            color: white;
        }
        
        .country-select {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .country-option {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            margin: 0.25rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .country-option:hover {
            background-color: var(--light-color);
            transform: translateX(5px);
        }
        
        .country-option.selected {
            background-color: var(--accent-color);
            color: white;
            transform: translateX(5px);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .main-container {
                margin: 0.5rem;
                border-radius: 15px;
            }
            
            .header-section {
                padding: 1.5rem 1rem;
                min-height: 100px;
            }
            
            .header-section h1 {
                font-size: 1.8rem;
                max-width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .header-controls {
                position: static;
                justify-content: center;
                margin-top: 1rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .stats-btn {
                font-size: 0.9rem;
                padding: 0.6rem 1.2rem;
            }
            
            .form-section {
                padding: 1rem;
            }
            
            .form-card {
                padding: 1.5rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            .tariffs-section {
                padding: 1rem !important;
                margin: 1rem !important;
            }
            
            .tariff-card {
                margin-bottom: 1rem;
            }
            
            .result-section {
                padding: 1.5rem !important;
                margin: 1rem !important;
            }
            
            .country-select {
                max-height: 300px;
                font-size: 0.9rem;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .d-flex.justify-content-between {
                flex-direction: column !important;
            }
            
            .accordion-body {
                padding: 1rem;
            }
            
            .form-check {
                flex: 1;
                min-width: 0;
                margin-bottom: 0.5rem;
            }
            
            .form-check-label {
                font-size: 0.9rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .badge {
                font-size: 0.7rem;
                padding: 0.25em 0.5em;
            }
        }
        
        @media (max-width: 480px) {
            .main-container {
                margin: 0.25rem;
            }
            
            .header-section h1 {
                font-size: 1.4rem;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .form-card {
                padding: 1rem !important;
            }
            
            .tariffs-section {
                padding: 0.5rem !important;
                margin: 0.5rem !important;
            }
            
            .result-section {
                padding: 1rem !important;
                margin: 0.5rem !important;
            }
            
            .form-control, .form-select {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .final-cost {
                font-size: 1.5rem;
                padding: 1.5rem;
            }
            
            .form-check {
                flex: 1 1 100%;
                margin-bottom: 0.75rem;
            }
            
            .form-check-label {
                font-size: 0.85rem;
                line-height: 1.2;
            }
            
            .d-flex.flex-wrap {
                flex-direction: column;
                gap: 0.5rem !important;
            }
        }
</style>

<div class="container-fluid">
    <div class="main-container">
        <!-- Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº -->
        <div class="header-section">
            <!-- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ² ÑˆĞ°Ğ¿ĞºĞµ -->
            <div class="header-controls">
                <a href="{% url 'cabinet_agency_dashboard' %}" class="stats-btn">
                    <i class="bi bi-arrow-left"></i> ĞĞ°Ğ·Ğ°Ğ´
                </a>
            </div>
            
            <h1><i class="bi bi-calculator"></i> ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ</h1>
            <p class="lead mb-0">Instagram Ğ¸ TikTok - ĞĞ³ĞµĞ½Ñ‚ÑĞºĞ¸Ğµ Ñ†ĞµĞ½Ñ‹ (ÑĞºĞ¸Ğ´ĞºĞ° 25%)</p>
        </div>

        <!-- Ğ¢Ğ°Ñ€Ğ¸Ñ„Ñ‹ -->
        <div class="tariffs-section">
            <h3><i class="bi bi-currency-exchange"></i> ĞĞ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ½Ğ°Ñ ÑĞµÑ‚ĞºĞ°</h3>
            <div class="alert alert-info text-center mb-3" id="rates-info">
                <strong>ĞĞ³ĞµĞ½Ñ‚ÑĞºĞ¸Ğµ Ñ†ĞµĞ½Ñ‹:</strong> ÑƒĞ¶Ğµ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ° ÑĞºĞ¸Ğ´ĞºĞ° 25% Ğ¾Ñ‚ Ñ€Ğ¾Ğ·Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ†ĞµĞ½ | 
                <strong>ĞšÑƒÑ€Ñ:</strong> <span id="currency-rates">Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ÑÑ...</span> | 
                <strong>ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼:</strong> 15 Ğ¼Ğ»Ğ½ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ² / 615,000 â‚½
                <button id="refresh-rates" class="btn btn-sm btn-outline-primary ms-2" style="display:none;" onclick="updateCurrencyRates()">
                    <i class="bi bi-arrow-clockwise"></i> ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºÑƒÑ€ÑÑ‹
                </button>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="tariff-card text-center">
                        <span class="tier-badge tier-1 mb-2">Tier 1</span>
                        <h5>ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</h5>
                        <p class="text-muted">ğŸ‡ºğŸ‡¸ Ğ¡Ğ¨Ğ, ğŸ‡¬ğŸ‡§ Ğ’ĞµĞ»Ğ¸ĞºĞ¾Ğ±Ñ€Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ, ğŸ‡©ğŸ‡ª Ğ“ĞµÑ€Ğ¼Ğ°Ğ½Ğ¸Ñ, ğŸ‡«ğŸ‡· Ğ¤Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ, ğŸ‡¯ğŸ‡µ Ğ¯Ğ¿Ğ¾Ğ½Ğ¸Ñ, ğŸ‡¨ğŸ‡¦ ĞšĞ°Ğ½Ğ°Ğ´Ğ°, ğŸ‡¦ğŸ‡º ĞĞ²ÑÑ‚Ñ€Ğ°Ğ»Ğ¸Ñ, ğŸ‡³ğŸ‡± ĞĞ¸Ğ´ĞµÑ€Ğ»Ğ°Ğ½Ğ´Ñ‹, ğŸ‡¸ğŸ‡ª Ğ¨Ğ²ĞµÑ†Ğ¸Ñ, ğŸ‡¨ğŸ‡­ Ğ¨Ğ²ĞµĞ¹Ñ†Ğ°Ñ€Ğ¸Ñ, ğŸ‡³ğŸ‡´ ĞĞ¾Ñ€Ğ²ĞµĞ³Ğ¸Ñ, ğŸ‡©ğŸ‡° Ğ”Ğ°Ğ½Ğ¸Ñ, ğŸ‡«ğŸ‡® Ğ¤Ğ¸Ğ½Ğ»ÑĞ½Ğ´Ğ¸Ñ, ğŸ‡¦ğŸ‡¹ ĞĞ²ÑÑ‚Ñ€Ğ¸Ñ, ğŸ‡§ğŸ‡ª Ğ‘ĞµĞ»ÑŒĞ³Ğ¸Ñ, ğŸ‡®ğŸ‡ª Ğ˜Ñ€Ğ»Ğ°Ğ½Ğ´Ğ¸Ñ, ğŸ‡¸ğŸ‡¬ Ğ¡Ğ¸Ğ½Ğ³Ğ°Ğ¿ÑƒÑ€, ğŸ‡­ğŸ‡° Ğ“Ğ¾Ğ½ĞºĞ¾Ğ½Ğ³, ğŸ‡°ğŸ‡· Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ, ğŸ‡³ğŸ‡¿ ĞĞ¾Ğ²Ğ°Ñ Ğ—ĞµĞ»Ğ°Ğ½Ğ´Ğ¸Ñ</p>
                        <div class="h4 text-primary">0.041 â‚½/Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€</div>
                        <small>CPM: 41 â‚½ | $0.44</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="tariff-card text-center">
                        <span class="tier-badge tier-2 mb-2">Tier 2</span>
                        <h5>Ğ Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸ĞµÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</h5>
                        <p class="text-muted">ğŸ‡®ğŸ‡¹ Ğ˜Ñ‚Ğ°Ğ»Ğ¸Ñ, ğŸ‡ªğŸ‡¸ Ğ˜ÑĞ¿Ğ°Ğ½Ğ¸Ñ, ğŸ‡µğŸ‡¹ ĞŸĞ¾Ñ€Ñ‚ÑƒĞ³Ğ°Ğ»Ğ¸Ñ, ğŸ‡¬ğŸ‡· Ğ“Ñ€ĞµÑ†Ğ¸Ñ, ğŸ‡µğŸ‡± ĞŸĞ¾Ğ»ÑŒÑˆĞ°, ğŸ‡¨ğŸ‡¿ Ğ§ĞµÑ…Ğ¸Ñ, ğŸ‡­ğŸ‡º Ğ’ĞµĞ½Ğ³Ñ€Ğ¸Ñ, ğŸ‡¸ğŸ‡° Ğ¡Ğ»Ğ¾Ğ²Ğ°ĞºĞ¸Ñ, ğŸ‡¸ğŸ‡® Ğ¡Ğ»Ğ¾Ğ²ĞµĞ½Ğ¸Ñ, ğŸ‡ªğŸ‡ª Ğ­ÑÑ‚Ğ¾Ğ½Ğ¸Ñ, ğŸ‡±ğŸ‡» Ğ›Ğ°Ñ‚Ğ²Ğ¸Ñ, ğŸ‡±ğŸ‡¹ Ğ›Ğ¸Ñ‚Ğ²Ğ°, ğŸ‡§ğŸ‡· Ğ‘Ñ€Ğ°Ğ·Ğ¸Ğ»Ğ¸Ñ, ğŸ‡®ğŸ‡³ Ğ˜Ğ½Ğ´Ğ¸Ñ, ğŸ‡·ğŸ‡º Ğ Ğ¾ÑÑĞ¸Ñ, ğŸ‡²ğŸ‡½ ĞœĞµĞºÑĞ¸ĞºĞ°, ğŸ‡¹ğŸ‡· Ğ¢ÑƒÑ€Ñ†Ğ¸Ñ, ğŸ‡¦ğŸ‡· ĞÑ€Ğ³ĞµĞ½Ñ‚Ğ¸Ğ½Ğ°, ğŸ‡¨ğŸ‡± Ğ§Ğ¸Ğ»Ğ¸, ğŸ‡¨ğŸ‡´ ĞšĞ¾Ğ»ÑƒĞ¼Ğ±Ğ¸Ñ, ğŸ‡µğŸ‡ª ĞŸĞµÑ€Ñƒ, ğŸ‡»ğŸ‡ª Ğ’ĞµĞ½ĞµÑÑƒÑĞ»Ğ°, ğŸ‡ºğŸ‡¾ Ğ£Ñ€ÑƒĞ³Ğ²Ğ°Ğ¹, ğŸ‡ªğŸ‡¨ Ğ­ĞºĞ²Ğ°Ğ´Ğ¾Ñ€, ğŸ‡§ğŸ‡´ Ğ‘Ğ¾Ğ»Ğ¸Ğ²Ğ¸Ñ, ğŸ‡µğŸ‡¾ ĞŸĞ°Ñ€Ğ°Ğ³Ğ²Ğ°Ğ¹, ğŸ‡¿ğŸ‡¦ Ğ®ĞĞ </p>
                        <div class="h4 text-warning">0.035 â‚½/Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€</div>
                        <small>CPM: 35 â‚½ | $0.38 (85%)</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="tariff-card text-center">
                        <span class="tier-badge tier-3 mb-2">Tier 3</span>
                        <h5>Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</h5>
                        <p class="text-muted">ğŸ‡³ğŸ‡¬ ĞĞ¸Ğ³ĞµÑ€Ğ¸Ñ, ğŸ‡°ğŸ‡ª ĞšĞµĞ½Ğ¸Ñ, ğŸ‡¬ğŸ‡­ Ğ“Ğ°Ğ½Ğ°, ğŸ‡ºğŸ‡¬ Ğ£Ğ³Ğ°Ğ½Ğ´Ğ°, ğŸ‡¹ğŸ‡¿ Ğ¢Ğ°Ğ½Ğ·Ğ°Ğ½Ğ¸Ñ, ğŸ‡ªğŸ‡¹ Ğ­Ñ„Ğ¸Ğ¾Ğ¿Ğ¸Ñ, ğŸ‡²ğŸ‡¿ ĞœĞ¾Ğ·Ğ°Ğ¼Ğ±Ğ¸Ğº, ğŸ‡¿ğŸ‡¼ Ğ—Ğ¸Ğ¼Ğ±Ğ°Ğ±Ğ²Ğµ, ğŸ‡¿ğŸ‡² Ğ—Ğ°Ğ¼Ğ±Ğ¸Ñ, ğŸ‡²ğŸ‡¼ ĞœĞ°Ğ»Ğ°Ğ²Ğ¸, ğŸ‡§ğŸ‡¼ Ğ‘Ğ¾Ñ‚ÑĞ²Ğ°Ğ½Ğ°, ğŸ‡³ğŸ‡¦ ĞĞ°Ğ¼Ğ¸Ğ±Ğ¸Ñ, ğŸ‡»ğŸ‡³ Ğ’ÑŒĞµÑ‚Ğ½Ğ°Ğ¼, ğŸ‡µğŸ‡­ Ğ¤Ğ¸Ğ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ñ‹, ğŸ‡ªğŸ‡¬ Ğ•Ğ³Ğ¸Ğ¿ĞµÑ‚, ğŸ‡µğŸ‡° ĞŸĞ°ĞºĞ¸ÑÑ‚Ğ°Ğ½, ğŸ‡§ğŸ‡© Ğ‘Ğ°Ğ½Ğ³Ğ»Ğ°Ğ´ĞµÑˆ, ğŸ‡±ğŸ‡° Ğ¨Ñ€Ğ¸-Ğ›Ğ°Ğ½ĞºĞ°, ğŸ‡³ğŸ‡µ ĞĞµĞ¿Ğ°Ğ», ğŸ‡²ğŸ‡² ĞœÑŒÑĞ½Ğ¼Ğ°, ğŸ‡°ğŸ‡­ ĞšĞ°Ğ¼Ğ±Ğ¾Ğ´Ğ¶Ğ°, ğŸ‡±ğŸ‡¦ Ğ›Ğ°Ğ¾Ñ, ğŸ‡²ğŸ‡³ ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»Ğ¸Ñ</p>
                        <div class="h4 text-danger">0.029 â‚½/Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€</div>
                        <small>CPM: 29 â‚½ | $0.31 (70%)</small>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="tariff-card text-center">
                        <span class="tier-badge tier-difficult mb-2">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ</span>
                        <h5>Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</h5>
                        <p class="text-muted">ğŸ‡¦ğŸ‡« ĞÑ„Ğ³Ğ°Ğ½Ğ¸ÑÑ‚Ğ°Ğ½, ğŸ‡®ğŸ‡· Ğ˜Ñ€Ğ°Ğ½, ğŸ‡®ğŸ‡¶ Ğ˜Ñ€Ğ°Ğº, ğŸ‡¸ğŸ‡¾ Ğ¡Ğ¸Ñ€Ğ¸Ñ, ğŸ‡±ğŸ‡§ Ğ›Ğ¸Ğ²Ğ°Ğ½, ğŸ‡¯ğŸ‡´ Ğ˜Ğ¾Ñ€Ğ´Ğ°Ğ½Ğ¸Ñ, ğŸ‡µğŸ‡¸ ĞŸĞ°Ğ»ĞµÑÑ‚Ğ¸Ğ½Ğ°, ğŸ‡¾ğŸ‡ª Ğ™ĞµĞ¼ĞµĞ½, ğŸ‡´ğŸ‡² ĞĞ¼Ğ°Ğ½, ğŸ‡°ğŸ‡¼ ĞšÑƒĞ²ĞµĞ¹Ñ‚, ğŸ‡¶ğŸ‡¦ ĞšĞ°Ñ‚Ğ°Ñ€, ğŸ‡§ğŸ‡­ Ğ‘Ğ°Ñ…Ñ€ĞµĞ¹Ğ½, ğŸ‡¦ğŸ‡ª ĞĞĞ­, ğŸ‡¸ğŸ‡¦ Ğ¡Ğ°ÑƒĞ´Ğ¾Ğ²ÑĞºĞ°Ñ ĞÑ€Ğ°Ğ²Ğ¸Ñ, ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ğ¸Ğ½Ğ°</p>
                        <div class="h4 text-dark">0.041 â‚½/Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€</div>
                        <small>CPM: 41 â‚½ + ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸</small>
                    </div>
                </div>
            </div>
            
            <!-- ĞĞ±ÑŠĞµĞ¼Ğ½Ñ‹Ğµ Ğ³Ñ€Ğ°Ğ´Ğ°Ñ†Ğ¸Ğ¸ -->
            <div class="mt-4">
                <h5 class="text-center mb-3">ĞĞ±ÑŠĞµĞ¼Ğ½Ñ‹Ğµ Ğ³Ñ€Ğ°Ğ´Ğ°Ñ†Ğ¸Ğ¸ (Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ¸Ğµ Ñ†ĞµĞ½Ñ‹)</h5>
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center p-3 bg-light rounded">
                            <strong>15-30 Ğ¼Ğ»Ğ½</strong><br>
                            <span class="text-primary">0.041 â‚½</span> | <span class="text-muted">$0.0004</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3 bg-light rounded">
                            <strong>30-50 Ğ¼Ğ»Ğ½</strong><br>
                            <span class="text-primary">0.038 â‚½</span> | <span class="text-muted">$0.0004</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3 bg-light rounded">
                            <strong>50-100 Ğ¼Ğ»Ğ½</strong><br>
                            <span class="text-primary">0.034 â‚½</span> | <span class="text-muted">$0.0004</span>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3 bg-light rounded">
                            <strong>100+ Ğ¼Ğ»Ğ½</strong><br>
                            <span class="text-primary">0.030 â‚½</span> | <span class="text-muted">$0.0003</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ° -->
        <div class="form-section">
            <form id="calcForm" class="form-card">
                <div class="row">
                    <!-- Ğ›ĞµĞ²Ğ°Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° -->
                    <div class="col-lg-6">
                        <h4><i class="bi bi-eye"></i> ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹</h4>
                        
                        <div class="mb-3">
                            <label for="views_mln" class="form-label">
                                <strong>ĞĞ±ÑŠĞµĞ¼ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ² (Ğ¼Ğ»Ğ½)</strong>
                                <i class="bi bi-info-circle text-muted" data-bs-toggle="tooltip" title="ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ±ÑŠĞµĞ¼: 15 Ğ¼Ğ»Ğ½ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²"></i>
                            </label>
                            <input type="number" class="form-control" id="views_mln" name="views_mln" min="15" max="1000" step="1" value="15" required>
                            <input type="range" class="form-range mt-2" id="views_slider" min="15" max="1000" step="1" value="15">
                            <small class="text-muted">ĞÑ‚ 15 Ğ´Ğ¾ 1000 Ğ¼Ğ»Ğ½ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²</small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label"><strong>ĞŸĞ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹</strong></label>
                            <div class="d-flex flex-wrap gap-2 gap-md-3">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="platform_instagram" name="platform_instagram" checked>
                                    <label class="form-check-label" for="platform_instagram">
                                        <i class="bi bi-instagram text-danger"></i> Instagram
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="platform_tiktok" name="platform_tiktok">
                                    <label class="form-check-label" for="platform_tiktok">
                                        <i class="bi bi-tiktok text-dark"></i> TikTok
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="platform_youtube_shorts" name="platform_youtube_shorts">
                                    <label class="form-check-label" for="platform_youtube_shorts">
                                        <i class="bi bi-youtube text-danger"></i> YouTube Shorts <span class="badge bg-warning">+15%</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="currency" class="form-label"><strong>Ğ’Ğ°Ğ»ÑÑ‚Ğ°</strong></label>
                            <select class="form-select" id="currency" name="currency">
                                <option value="USD" selected>Ğ”Ğ¾Ğ»Ğ»Ğ°Ñ€Ñ‹ ($)</option>
                                <option value="RUB">Ğ ÑƒĞ±Ğ»Ğ¸ (â‚½)</option>
                                <option value="EUR">Ğ•Ğ²Ñ€Ğ¾ (â‚¬)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="countries" class="form-label"><strong>Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ğ½</strong></label>
                            <div class="country-select border rounded p-2">
                                <div class="mb-2">
                                    <strong class="text-primary">Tier 1 - ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</strong>
                                    <div class="country-option" data-country="USA" data-tier="1">ğŸ‡ºğŸ‡¸ Ğ¡Ğ¨Ğ</div>
                                    <div class="country-option" data-country="UK" data-tier="1">ğŸ‡¬ğŸ‡§ Ğ’ĞµĞ»Ğ¸ĞºĞ¾Ğ±Ñ€Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="DE" data-tier="1">ğŸ‡©ğŸ‡ª Ğ“ĞµÑ€Ğ¼Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="FR" data-tier="1">ğŸ‡«ğŸ‡· Ğ¤Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ</div>
                                    <div class="country-option" data-country="JP" data-tier="1">ğŸ‡¯ğŸ‡µ Ğ¯Ğ¿Ğ¾Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="CA" data-tier="1">ğŸ‡¨ğŸ‡¦ ĞšĞ°Ğ½Ğ°Ğ´Ğ°</div>
                                    <div class="country-option" data-country="AU" data-tier="1">ğŸ‡¦ğŸ‡º ĞĞ²ÑÑ‚Ñ€Ğ°Ğ»Ğ¸Ñ</div>
                                    <div class="country-option" data-country="NL" data-tier="1">ğŸ‡³ğŸ‡± ĞĞ¸Ğ´ĞµÑ€Ğ»Ğ°Ğ½Ğ´Ñ‹</div>
                                    <div class="country-option" data-country="SE" data-tier="1">ğŸ‡¸ğŸ‡ª Ğ¨Ğ²ĞµÑ†Ğ¸Ñ</div>
                                    <div class="country-option" data-country="CH" data-tier="1">ğŸ‡¨ğŸ‡­ Ğ¨Ğ²ĞµĞ¹Ñ†Ğ°Ñ€Ğ¸Ñ</div>
                                    <div class="country-option" data-country="NO" data-tier="1">ğŸ‡³ğŸ‡´ ĞĞ¾Ñ€Ğ²ĞµĞ³Ğ¸Ñ</div>
                                    <div class="country-option" data-country="DK" data-tier="1">ğŸ‡©ğŸ‡° Ğ”Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="FI" data-tier="1">ğŸ‡«ğŸ‡® Ğ¤Ğ¸Ğ½Ğ»ÑĞ½Ğ´Ğ¸Ñ</div>
                                    <div class="country-option" data-country="AT" data-tier="1">ğŸ‡¦ğŸ‡¹ ĞĞ²ÑÑ‚Ñ€Ğ¸Ñ</div>
                                    <div class="country-option" data-country="BE" data-tier="1">ğŸ‡§ğŸ‡ª Ğ‘ĞµĞ»ÑŒĞ³Ğ¸Ñ</div>
                                    <div class="country-option" data-country="IE" data-tier="1">ğŸ‡®ğŸ‡ª Ğ˜Ñ€Ğ»Ğ°Ğ½Ğ´Ğ¸Ñ</div>
                                    <div class="country-option" data-country="SG" data-tier="1">ğŸ‡¸ğŸ‡¬ Ğ¡Ğ¸Ğ½Ğ³Ğ°Ğ¿ÑƒÑ€</div>
                                    <div class="country-option" data-country="HK" data-tier="1">ğŸ‡­ğŸ‡° Ğ“Ğ¾Ğ½ĞºĞ¾Ğ½Ğ³</div>
                                    <div class="country-option" data-country="KR" data-tier="1">ğŸ‡°ğŸ‡· Ğ®Ğ¶Ğ½Ğ°Ñ ĞšĞ¾Ñ€ĞµÑ</div>
                                    <div class="country-option" data-country="NZ" data-tier="1">ğŸ‡³ğŸ‡¿ ĞĞ¾Ğ²Ğ°Ñ Ğ—ĞµĞ»Ğ°Ğ½Ğ´Ğ¸Ñ</div>
                                </div>
                                <div class="mb-2">
                                    <strong class="text-warning">Tier 2 - Ğ Ğ°Ğ·Ğ²Ğ¸Ğ²Ğ°ÑÑ‰Ğ¸ĞµÑÑ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</strong>
                                    <div class="country-option" data-country="IT" data-tier="2">ğŸ‡®ğŸ‡¹ Ğ˜Ñ‚Ğ°Ğ»Ğ¸Ñ</div>
                                    <div class="country-option" data-country="ES" data-tier="2">ğŸ‡ªğŸ‡¸ Ğ˜ÑĞ¿Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="PT" data-tier="2">ğŸ‡µğŸ‡¹ ĞŸĞ¾Ñ€Ñ‚ÑƒĞ³Ğ°Ğ»Ğ¸Ñ</div>
                                    <div class="country-option" data-country="GR" data-tier="2">ğŸ‡¬ğŸ‡· Ğ“Ñ€ĞµÑ†Ğ¸Ñ</div>
                                    <div class="country-option" data-country="PL" data-tier="2">ğŸ‡µğŸ‡± ĞŸĞ¾Ğ»ÑŒÑˆĞ°</div>
                                    <div class="country-option" data-country="CZ" data-tier="2">ğŸ‡¨ğŸ‡¿ Ğ§ĞµÑ…Ğ¸Ñ</div>
                                    <div class="country-option" data-country="HU" data-tier="2">ğŸ‡­ğŸ‡º Ğ’ĞµĞ½Ğ³Ñ€Ğ¸Ñ</div>
                                    <div class="country-option" data-country="SK" data-tier="2">ğŸ‡¸ğŸ‡° Ğ¡Ğ»Ğ¾Ğ²Ğ°ĞºĞ¸Ñ</div>
                                    <div class="country-option" data-country="SI" data-tier="2">ğŸ‡¸ğŸ‡® Ğ¡Ğ»Ğ¾Ğ²ĞµĞ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="EE" data-tier="2">ğŸ‡ªğŸ‡ª Ğ­ÑÑ‚Ğ¾Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="LV" data-tier="2">ğŸ‡±ğŸ‡» Ğ›Ğ°Ñ‚Ğ²Ğ¸Ñ</div>
                                    <div class="country-option" data-country="LT" data-tier="2">ğŸ‡±ğŸ‡¹ Ğ›Ğ¸Ñ‚Ğ²Ğ°</div>
                                    <div class="country-option" data-country="BR" data-tier="2">ğŸ‡§ğŸ‡· Ğ‘Ñ€Ğ°Ğ·Ğ¸Ğ»Ğ¸Ñ</div>
                                    <div class="country-option" data-country="IN" data-tier="2">ğŸ‡®ğŸ‡³ Ğ˜Ğ½Ğ´Ğ¸Ñ</div>
                                    <div class="country-option" data-country="RU" data-tier="2">ğŸ‡·ğŸ‡º Ğ Ğ¾ÑÑĞ¸Ñ</div>
                                    <div class="country-option" data-country="MX" data-tier="2">ğŸ‡²ğŸ‡½ ĞœĞµĞºÑĞ¸ĞºĞ°</div>
                                    <div class="country-option" data-country="TR" data-tier="2">ğŸ‡¹ğŸ‡· Ğ¢ÑƒÑ€Ñ†Ğ¸Ñ</div>
                                    <div class="country-option" data-country="AR" data-tier="2">ğŸ‡¦ğŸ‡· ĞÑ€Ğ³ĞµĞ½Ñ‚Ğ¸Ğ½Ğ°</div>
                                    <div class="country-option" data-country="CL" data-tier="2">ğŸ‡¨ğŸ‡± Ğ§Ğ¸Ğ»Ğ¸</div>
                                    <div class="country-option" data-country="CO" data-tier="2">ğŸ‡¨ğŸ‡´ ĞšĞ¾Ğ»ÑƒĞ¼Ğ±Ğ¸Ñ</div>
                                    <div class="country-option" data-country="PE" data-tier="2">ğŸ‡µğŸ‡ª ĞŸĞµÑ€Ñƒ</div>
                                    <div class="country-option" data-country="VE" data-tier="2">ğŸ‡»ğŸ‡ª Ğ’ĞµĞ½ĞµÑÑƒÑĞ»Ğ°</div>
                                    <div class="country-option" data-country="UY" data-tier="2">ğŸ‡ºğŸ‡¾ Ğ£Ñ€ÑƒĞ³Ğ²Ğ°Ğ¹</div>
                                    <div class="country-option" data-country="EC" data-tier="2">ğŸ‡ªğŸ‡¨ Ğ­ĞºĞ²Ğ°Ğ´Ğ¾Ñ€</div>
                                    <div class="country-option" data-country="BO" data-tier="2">ğŸ‡§ğŸ‡´ Ğ‘Ğ¾Ğ»Ğ¸Ğ²Ğ¸Ñ</div>
                                    <div class="country-option" data-country="PY" data-tier="2">ğŸ‡µğŸ‡¾ ĞŸĞ°Ñ€Ğ°Ğ³Ğ²Ğ°Ğ¹</div>
                                    <div class="country-option" data-country="ZA" data-tier="2">ğŸ‡¿ğŸ‡¦ Ğ®ĞĞ </div>
                                </div>
                                <div class="mb-2">
                                    <strong class="text-danger">Tier 3 - Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‡Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</strong>
                                    <div class="country-option" data-country="NG" data-tier="3">ğŸ‡³ğŸ‡¬ ĞĞ¸Ğ³ĞµÑ€Ğ¸Ñ</div>
                                    <div class="country-option" data-country="KE" data-tier="3">ğŸ‡°ğŸ‡ª ĞšĞµĞ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="GH" data-tier="3">ğŸ‡¬ğŸ‡­ Ğ“Ğ°Ğ½Ğ°</div>
                                    <div class="country-option" data-country="UG" data-tier="3">ğŸ‡ºğŸ‡¬ Ğ£Ğ³Ğ°Ğ½Ğ´Ğ°</div>
                                    <div class="country-option" data-country="TZ" data-tier="3">ğŸ‡¹ğŸ‡¿ Ğ¢Ğ°Ğ½Ğ·Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="ET" data-tier="3">ğŸ‡ªğŸ‡¹ Ğ­Ñ„Ğ¸Ğ¾Ğ¿Ğ¸Ñ</div>
                                    <div class="country-option" data-country="MZ" data-tier="3">ğŸ‡²ğŸ‡¿ ĞœĞ¾Ğ·Ğ°Ğ¼Ğ±Ğ¸Ğº</div>
                                    <div class="country-option" data-country="ZW" data-tier="3">ğŸ‡¿ğŸ‡¼ Ğ—Ğ¸Ğ¼Ğ±Ğ°Ğ±Ğ²Ğµ</div>
                                    <div class="country-option" data-country="ZM" data-tier="3">ğŸ‡¿ğŸ‡² Ğ—Ğ°Ğ¼Ğ±Ğ¸Ñ</div>
                                    <div class="country-option" data-country="MW" data-tier="3">ğŸ‡²ğŸ‡¼ ĞœĞ°Ğ»Ğ°Ğ²Ğ¸</div>
                                    <div class="country-option" data-country="BW" data-tier="3">ğŸ‡§ğŸ‡¼ Ğ‘Ğ¾Ñ‚ÑĞ²Ğ°Ğ½Ğ°</div>
                                    <div class="country-option" data-country="NAM" data-tier="3">ğŸ‡³ğŸ‡¦ ĞĞ°Ğ¼Ğ¸Ğ±Ğ¸Ñ</div>
                                    <div class="country-option" data-country="VN" data-tier="3">ğŸ‡»ğŸ‡³ Ğ’ÑŒĞµÑ‚Ğ½Ğ°Ğ¼</div>
                                    <div class="country-option" data-country="PH" data-tier="3">ğŸ‡µğŸ‡­ Ğ¤Ğ¸Ğ»Ğ¸Ğ¿Ğ¿Ğ¸Ğ½Ñ‹</div>
                                    <div class="country-option" data-country="EG" data-tier="3">ğŸ‡ªğŸ‡¬ Ğ•Ğ³Ğ¸Ğ¿ĞµÑ‚</div>
                                    <div class="country-option" data-country="PK" data-tier="3">ğŸ‡µğŸ‡° ĞŸĞ°ĞºĞ¸ÑÑ‚Ğ°Ğ½</div>
                                    <div class="country-option" data-country="BD" data-tier="3">ğŸ‡§ğŸ‡© Ğ‘Ğ°Ğ½Ğ³Ğ»Ğ°Ğ´ĞµÑˆ</div>
                                    <div class="country-option" data-country="LK" data-tier="3">ğŸ‡±ğŸ‡° Ğ¨Ñ€Ğ¸-Ğ›Ğ°Ğ½ĞºĞ°</div>
                                    <div class="country-option" data-country="NP" data-tier="3">ğŸ‡³ğŸ‡µ ĞĞµĞ¿Ğ°Ğ»</div>
                                    <div class="country-option" data-country="MM" data-tier="3">ğŸ‡²ğŸ‡² ĞœÑŒÑĞ½Ğ¼Ğ°</div>
                                    <div class="country-option" data-country="KH" data-tier="3">ğŸ‡°ğŸ‡­ ĞšĞ°Ğ¼Ğ±Ğ¾Ğ´Ğ¶Ğ°</div>
                                    <div class="country-option" data-country="LA" data-tier="3">ğŸ‡±ğŸ‡¦ Ğ›Ğ°Ğ¾Ñ</div>
                                    <div class="country-option" data-country="MN" data-tier="3">ğŸ‡²ğŸ‡³ ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»Ğ¸Ñ</div>
                                </div>
                                <div class="mb-2">
                                    <strong class="text-dark">Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹</strong>
                                    <div class="country-option" data-country="AF" data-tier="difficult">ğŸ‡¦ğŸ‡« ĞÑ„Ğ³Ğ°Ğ½Ğ¸ÑÑ‚Ğ°Ğ½</div>
                                    <div class="country-option" data-country="IR" data-tier="difficult">ğŸ‡®ğŸ‡· Ğ˜Ñ€Ğ°Ğ½</div>
                                    <div class="country-option" data-country="IQ" data-tier="difficult">ğŸ‡®ğŸ‡¶ Ğ˜Ñ€Ğ°Ğº</div>
                                    <div class="country-option" data-country="SY" data-tier="difficult">ğŸ‡¸ğŸ‡¾ Ğ¡Ğ¸Ñ€Ğ¸Ñ</div>
                                    <div class="country-option" data-country="LB" data-tier="difficult">ğŸ‡±ğŸ‡§ Ğ›Ğ¸Ğ²Ğ°Ğ½</div>
                                    <div class="country-option" data-country="JO" data-tier="difficult">ğŸ‡¯ğŸ‡´ Ğ˜Ğ¾Ñ€Ğ´Ğ°Ğ½Ğ¸Ñ</div>
                                    <div class="country-option" data-country="PS" data-tier="difficult">ğŸ‡µğŸ‡¸ ĞŸĞ°Ğ»ĞµÑÑ‚Ğ¸Ğ½Ğ°</div>
                                    <div class="country-option" data-country="YE" data-tier="difficult">ğŸ‡¾ğŸ‡ª Ğ™ĞµĞ¼ĞµĞ½</div>
                                    <div class="country-option" data-country="OM" data-tier="difficult">ğŸ‡´ğŸ‡² ĞĞ¼Ğ°Ğ½</div>
                                    <div class="country-option" data-country="KW" data-tier="difficult">ğŸ‡°ğŸ‡¼ ĞšÑƒĞ²ĞµĞ¹Ñ‚</div>
                                    <div class="country-option" data-country="QA" data-tier="difficult">ğŸ‡¶ğŸ‡¦ ĞšĞ°Ñ‚Ğ°Ñ€</div>
                                    <div class="country-option" data-country="BH" data-tier="difficult">ğŸ‡§ğŸ‡­ Ğ‘Ğ°Ñ…Ñ€ĞµĞ¹Ğ½</div>
                                    <div class="country-option" data-country="AE" data-tier="difficult">ğŸ‡¦ğŸ‡ª ĞĞĞ­</div>
                                    <div class="country-option" data-country="SA" data-tier="difficult">ğŸ‡¸ğŸ‡¦ Ğ¡Ğ°ÑƒĞ´Ğ¾Ğ²ÑĞºĞ°Ñ ĞÑ€Ğ°Ğ²Ğ¸Ñ</div>
                                    <div class="country-option" data-country="UA" data-tier="difficult">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ğ¸Ğ½Ğ°</div>
                                </div>
                            </div>
                            <small class="text-muted">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ğ´Ğ½Ñƒ Ğ¸Ğ»Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ñ€Ğ°Ğ½ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ</small>
                        </div>
                    </div>

                    <!-- ĞŸÑ€Ğ°Ğ²Ğ°Ñ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ° -->
                    <div class="col-lg-6">
                        <h4><i class="bi bi-tags"></i> Ğ¡ĞºĞ¸Ğ´ĞºĞ¸ Ğ¸ Ğ½Ğ°Ğ´Ğ±Ğ°Ğ²ĞºĞ¸</h4>
                        
                        <div class="mb-3">
                            <label class="form-label"><strong>Ğ¡ĞºĞ¸Ğ´ĞºĞ¸</strong></label>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="own_badge" name="own_badge">
                                <label class="form-check-label" for="own_badge">Ğ¡Ğ²Ğ¾Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶ (-3%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="own_content" name="own_content">
                                <label class="form-check-label" for="own_content">Ğ¡Ğ²Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ (-15%)</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="pilot" name="pilot">
                                <label class="form-check-label" for="pilot">ĞŸĞ¸Ğ»Ğ¾Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ (-10%)</label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="vip_discount" class="form-label"><strong>VIP ÑĞºĞ¸Ğ´ĞºĞ°</strong></label>
                            <select class="form-select" id="vip_discount" name="vip_discount">
                                <option value="0">0%</option>
                                <option value="3">3%</option>
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                            </select>
                        </div>

                        <h4><i class="bi bi-plus-circle"></i> Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑƒÑĞ»ÑƒĞ³Ğ¸</h4>
                        <div class="alert alert-info">
                            <small><i class="bi bi-info-circle"></i> ĞĞ°Ğ´Ğ±Ğ°Ğ²ĞºĞ° Ğ·Ğ° ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ (+30%) Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… ÑÑ‚Ñ€Ğ°Ğ½</small>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="urgency" name="urgency">
                            <label class="form-check-label" for="urgency">Ğ¡Ñ€Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ (+40%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="peak_season" name="peak_season">
                            <label class="form-check-label" for="peak_season">ĞŸĞ¸ĞºĞ¾Ğ²Ñ‹Ğ¹ ÑĞµĞ·Ğ¾Ğ½ (+25%)</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="exclusive_content" name="exclusive_content">
                            <label class="form-check-label" for="exclusive_content">Ğ­ĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚ (+35%)</label>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-primary" id="calculateBtn">
                        <i class="bi bi-calculator"></i> Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ
                    </button>
                    <button type="button" class="btn btn-secondary" id="resetForm">
                        <i class="bi bi-arrow-clockwise"></i> Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ
                    </button>
                </div>
            </form>
        </div>

        <!-- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ -->
        <div class="result-section" id="resultBlock" style="display:none;">
            <h3 class="text-center mb-4"><i class="bi bi-graph-up"></i> Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°</h3>
            
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="h5 text-primary">ĞĞ±ÑŠĞµĞ¼ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²</div>
                        <div class="h3" id="res_views">-</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="h5 text-success">Ğ¦ĞµĞ½Ğ° Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€</div>
                        <div class="h3" id="res_cpv">-</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="h5 text-warning">ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ°Ğ½Ğµ</div>
                        <div class="h3" id="res_multiplier">-</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="text-center">
                        <div class="h5 text-info">Ğ Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ğ°Ñ ÑĞºĞ¸Ğ´ĞºĞ°</div>
                        <div class="h3" id="res_market_discount">-</div>
                    </div>
                </div>
            </div>
            
            <!-- ĞĞ¾Ğ²Ğ°Ñ ÑĞµĞºÑ†Ğ¸Ñ Ñ Ñ†ĞµĞ½Ğ°Ğ¼Ğ¸ Ğ¿Ğ¾ CPM Ğ¸ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ Ñ†ĞµĞ½Ğ°Ğ¼Ğ¸ -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="h5 text-primary">CPM (Ğ·Ğ° 1000 Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²)</div>
                        <div class="h3" id="res_cpm">-</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="h5 text-success">Ğ¦ĞµĞ½Ğ° Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¾ ÑĞºĞ¸Ğ´ĞºĞ°Ğ¼Ğ¸</div>
                        <div class="h3" id="res_cpv_final">-</div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center">
                        <div class="h5 text-warning">CPM ÑĞ¾ ÑĞºĞ¸Ğ´ĞºĞ°Ğ¼Ğ¸</div>
                        <div class="h3" id="res_cpm_final">-</div>
                    </div>
                </div>
            </div>
            
            <div class="row mb-4" id="platform_multiplier_row" style="display:none;">
                <div class="col-md-6 offset-md-3">
                    <div class="text-center">
                        <div class="h5 text-danger" id="res_platform_multiplier_label">ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹</div>
                        <div class="h3" id="res_platform_multiplier">-</div>
                    </div>
                </div>
            </div>

            <div class="accordion mb-4" id="resultAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMarkups">
                            <i class="bi bi-plus-circle"></i> ĞĞ°Ğ´Ğ±Ğ°Ğ²ĞºĞ¸
                        </button>
                    </h2>
                    <div id="collapseMarkups" class="accordion-collapse collapse show">
                        <div class="accordion-body">
                            <div id="res_markups"></div>
                            <div class="mt-2">
                                <strong>ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ğ½Ğ°Ğ´Ğ±Ğ°Ğ²Ğ¾Ğº: <span id="res_markup_amount">-</span></strong>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDiscounts">
                            <i class="bi bi-dash-circle"></i> Ğ¡ĞºĞ¸Ğ´ĞºĞ¸
                        </button>
                    </h2>
                    <div id="collapseDiscounts" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <div id="res_discounts"></div>
                            <div class="mt-2">
                                <strong>ĞĞ±Ñ‰Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° ÑĞºĞ¸Ğ´Ğ¾Ğº: <span id="res_discount_amount">-</span></strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="final-cost">
                <div class="h4 mb-2">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ</div>
                <div class="h1" id="res_final_cost">-</div>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-success me-2" id="saveCalc">
                    <i class="bi bi-save"></i> Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ñ€Ğ°ÑÑ‡ĞµÑ‚
                </button>
                <button class="btn btn-info me-2" id="copySummary">
                    <i class="bi bi-clipboard"></i> ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
                </button>
                <a class="btn btn-primary me-2" id="downloadExcel" href="#" style="display:none;" data-loading-text="Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ¼ Excel...">
                    <span class="btn-label"><i class="bi bi-file-earmark-excel"></i> Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Excel</span>
                    <span class="spinner-border spinner-border-sm ms-2" role="status" aria-hidden="true" style="display:none;"></span>
                </a>
                <a class="btn btn-secondary" href="{% url 'cabinet_export_calculations_csv' %}">
                    <i class="bi bi-file-earmark-csv"></i> Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ¾Ğ² (CSV)
                </a>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
        // Modal for client name after save
        const clientNameModalHtml = `
<div class="modal fade" id="clientNameModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ğ˜Ğ¼Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <label for="client_name_input" class="form-label">Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğ´Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ°</label>
        <input type="text" class="form-control" id="client_name_input" placeholder="Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
        <button type="button" class="btn btn-primary" id="client_name_save_btn">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
      </div>
    </div>
  </div>
</div>`;
        document.addEventListener('DOMContentLoaded', function() {
            // Inject modal once
            const wrapper = document.createElement('div');
            wrapper.innerHTML = clientNameModalHtml;
            document.body.appendChild(wrapper);
        });
        // ĞĞ³ĞµĞ½Ñ‚ÑĞºĞ¸Ğµ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹ (ÑƒĞ¶Ğµ Ñ 25% ÑĞºĞ¸Ğ´ĞºĞ¾Ğ¹ Ğ¾Ñ‚ Ñ€Ğ¾Ğ·Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ†ĞµĞ½)
        const BASE_TARIFFS = {
            15000000: 0.041,   // 15-30 Ğ¼Ğ»Ğ½ - 0.041 â‚½ Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€
            30000000: 0.038,   // 30-50 Ğ¼Ğ»Ğ½ - 0.038 â‚½ Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ 
            50000000: 0.034,   // 50-100 Ğ¼Ğ»Ğ½ - 0.034 â‚½ Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€
            100000000: 0.030   // 100+ Ğ¼Ğ»Ğ½ - 0.030 â‚½ Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€
        };
        
        const COUNTRY_MULTIPLIERS = {
            1: 1.0,    // Tier1 - Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ñ†ĞµĞ½Ğ°
            2: 0.85,   // Tier2 - ÑĞºĞ¸Ğ´ĞºĞ° 15%
            3: 0.7,    // Tier3 - ÑĞºĞ¸Ğ´ĞºĞ° 30%
            'difficult': 1.0  // Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ - Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ñ†ĞµĞ½Ğ° (100%)
        };
        
        const MARKET_DISCOUNTS = {
            50000000: 5,      // 50 Ğ¼Ğ»Ğ½+ - ÑĞºĞ¸Ğ´ĞºĞ° 5%
            100000000: 10,    // 100 Ğ¼Ğ»Ğ½+ - ÑĞºĞ¸Ğ´ĞºĞ° 10%
            200000000: 15,    // 200 Ğ¼Ğ»Ğ½+ - ÑĞºĞ¸Ğ´ĞºĞ° 15%
            500000000: 20     // 500 Ğ¼Ğ»Ğ½+ - ÑĞºĞ¸Ğ´ĞºĞ° 20%
        };
        
        const DISCOUNTS = {
            'own_badge': 3,
            'own_content': 15,
            'pilot': 10
        };
        
        const MARKUPS = {
            'urgency': 40,
            'peak_season': 25,
            'exclusive_content': 35
        };
        
        // ĞšÑƒÑ€ÑÑ‹ Ğ²Ğ°Ğ»ÑÑ‚ (Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ÑÑ‚ÑÑ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°)
        let usdToRub = 92.5;  // Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
        let eurToRub = 100.8; // Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
        let currencySource = 'fallback';
        
        // Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹
        let selectedCountries = [];
        
        function getCookie(name){
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        
        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ ĞºÑƒÑ€ÑĞ°Ğ¼Ğ¸ Ğ²Ğ°Ğ»ÑÑ‚
        async function loadCurrencyRates() {
            try {
                const response = await fetch('/cabinet/api/currency/rates/', {
                    method: 'GET',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.rates) {
                        updateCurrencyDisplay(data.rates);
                    }
                } else {
                    console.warn('ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ ĞºÑƒÑ€ÑÑ‹ Ğ²Ğ°Ğ»ÑÑ‚, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ');
                    updateCurrencyDisplay({
                        usd_rub: usdToRub,
                        eur_rub: eurToRub,
                        source: 'fallback'
                    });
                }
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºÑƒÑ€ÑĞ¾Ğ² Ğ²Ğ°Ğ»ÑÑ‚:', error);
                updateCurrencyDisplay({
                    usd_rub: usdToRub,
                    eur_rub: eurToRub,
                    source: 'fallback'
                });
            }
        }
        
        function updateCurrencyDisplay(rates) {
            usdToRub = rates.usd_rub;
            eurToRub = rates.eur_rub;
            currencySource = rates.source;
            
            const sourceInfo = rates.source === 'cbr' ? '(Ğ¦Ğ‘ Ğ Ğ¤)' : 
                              rates.source === 'exchangerate-api' ? '(ExchangeRate API)' :
                              rates.source === 'fixer' ? '(Fixer.io)' : '(Ñ€ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğµ)';
            
            const ratesElement = document.getElementById('currency-rates');
            ratesElement.innerHTML = `1 USD = ${usdToRub.toFixed(2)} â‚½, 1 EUR = ${eurToRub.toFixed(2)} â‚½ ${sourceInfo}`;
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ superuser
            const refreshBtn = document.getElementById('refresh-rates');
            if (rates.source !== 'fallback' && refreshBtn) {
                refreshBtn.style.display = 'inline-block';
            }
            
            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
            const ratesInfo = document.getElementById('rates-info');
            if (rates.source === 'fallback') {
                ratesInfo.classList.add('alert-warning');
                ratesInfo.classList.remove('alert-info');
            } else {
                ratesInfo.classList.add('alert-info');
                ratesInfo.classList.remove('alert-warning');
            }
        }
        
        async function updateCurrencyRates() {
            const refreshBtn = document.getElementById('refresh-rates');
            const originalText = refreshBtn.innerHTML;
            
            try {
                refreshBtn.disabled = true;
                refreshBtn.innerHTML = '<i class="bi bi-arrow-clockwise spin"></i> ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ...';
                
                const response = await fetch('/cabinet/api/currency/force-update/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    },
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.rates) {
                        updateCurrencyDisplay(data.rates);
                        showNotification('ĞšÑƒÑ€ÑÑ‹ Ğ²Ğ°Ğ»ÑÑ‚ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹', 'success');
                        
                        // ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ Ğ½Ğ¾Ğ²Ñ‹Ğ¼Ğ¸ ĞºÑƒÑ€ÑĞ°Ğ¼Ğ¸
                        calculate();
                    }
                } else {
                    showNotification('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºÑƒÑ€ÑĞ¾Ğ² Ğ²Ğ°Ğ»ÑÑ‚', 'error');
                }
            } catch (error) {
                console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºÑƒÑ€ÑĞ¾Ğ² Ğ²Ğ°Ğ»ÑÑ‚:', error);
                showNotification('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ Ğº ÑĞµÑ€Ğ²ĞµÑ€Ñƒ', 'error');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = originalText;
            }
        }
        
        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrencyRates();
            initializeCountrySelection();
            initializeEventHandlers();
            calculate();
        });
        
        function initializeCountrySelection() {
            document.querySelectorAll('.country-option').forEach(element => {
                element.addEventListener('click', function() {
                    const country = this.dataset.country;
                    const tier = this.dataset.tier;
                    
                    if (this.classList.contains('selected')) {
                        this.classList.remove('selected');
                        selectedCountries = selectedCountries.filter(c => c.code !== country);
                    } else {
                        this.classList.add('selected');
                        selectedCountries.push({ code: country, tier: tier });
                    }
                    
                    calculate();
                });
            });
        }
        
        function initializeEventHandlers() {
            // Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑĞ»Ğ°Ğ¹Ğ´ĞµÑ€Ğ° Ğ¸ Ğ¿Ğ¾Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°
            document.getElementById('views_mln').addEventListener('input', function() {
                document.getElementById('views_slider').value = this.value;
                calculate();
            });
            
            document.getElementById('views_slider').addEventListener('input', function() {
                document.getElementById('views_mln').value = this.value;
                calculate();
            });
            
            // ĞŸĞµÑ€ĞµÑÑ‡ĞµÑ‚ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ»ÑĞ±Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹
            document.querySelectorAll('#calcForm input, #calcForm select').forEach(element => {
                element.addEventListener('change', calculate);
            });
            
            // ĞšĞ½Ğ¾Ğ¿ĞºĞ¸
            document.getElementById('calculateBtn').addEventListener('click', calculate);
            document.getElementById('resetForm').addEventListener('click', resetForm);
            document.getElementById('saveCalc').addEventListener('click', saveCalculation);
            document.getElementById('copySummary').addEventListener('click', copySummary);
        }
        
        function calculate() {
            const views_mln = parseFloat(document.getElementById('views_mln').value) || 0;
            const views = views_mln * 1000000;
            
            if (views_mln < 15) {
                document.getElementById('resultBlock').style.display = 'none';
                return;
            }
            
            if (!document.getElementById('platform_instagram').checked && 
                !document.getElementById('platform_tiktok').checked && 
                !document.getElementById('platform_youtube_shorts').checked) {
                return;
            }
            
            // Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ Ñ€Ğ°ÑÑ‡ĞµÑ‚
            const basePrice = getBasePrice(views);
            const baseCost = views * basePrice;
            
            // ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ°Ğ½Ğ°Ğ¼
            const countryMultiplier = getCountryMultiplier();
            const adjustedCost = baseCost * countryMultiplier;
            
            // Ğ Ñ‹Ğ½Ğ¾Ñ‡Ğ½Ğ°Ñ ÑĞºĞ¸Ğ´ĞºĞ°
            const marketDiscount = getMarketDiscount(views);
            const marketDiscountAmount = adjustedCost * (marketDiscount / 100);
            const costAfterMarketDiscount = adjustedCost - marketDiscountAmount;
            
            // ĞœĞ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ°Ğ¼
            const platformMultiplier = getPlatformMultiplier();
            const costAfterPlatform = costAfterMarketDiscount * platformMultiplier;
            
            // Ğ¡ĞºĞ¸Ğ´ĞºĞ¸
            const { discountPercent, discountList } = calculateDiscounts();
            const discountAmount = costAfterPlatform * (discountPercent / 100);
            const costAfterDiscounts = costAfterPlatform - discountAmount;
            
            // ĞĞ°Ğ´Ğ±Ğ°Ğ²ĞºĞ¸
            const { markupPercent, markupList } = calculateMarkups();
            const markupAmount = costAfterDiscounts * (markupPercent / 100);
            const finalCost = costAfterDiscounts + markupAmount;
            
            // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹
            const currency = document.getElementById('currency').value;
            const { symbol, convertedCost } = convertCurrency(finalCost, currency);
            
            // ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
            displayResults(views_mln, basePrice, countryMultiplier, marketDiscount, 
                         platformMultiplier, discountAmount, markupAmount, convertedCost, symbol, 
                         discountList, markupList, currency);
        }
        
        function getBasePrice(views) {
            // ĞĞ³ĞµĞ½Ñ‚ÑĞºĞ¸Ğµ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ñ‹ Ğ¿Ğ¾ Ğ¾Ğ±ÑŠĞµĞ¼Ğ½Ñ‹Ğ¼ Ğ³Ñ€Ğ°Ğ´Ğ°Ñ†Ğ¸ÑĞ¼
            if (views >= 100000000) return 0.030;  // 100+ Ğ¼Ğ»Ğ½ - Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ†ĞµĞ½Ğ°
            if (views >= 50000000) return 0.034;   // 50-100 Ğ¼Ğ»Ğ½ - Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ†ĞµĞ½Ğ°
            if (views >= 30000000) return 0.038;   // 30-50 Ğ¼Ğ»Ğ½ - Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ†ĞµĞ½Ğ°
            if (views >= 15000000) return 0.041;   // 15-30 Ğ¼Ğ»Ğ½ - Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ†ĞµĞ½Ğ°
            return 0.041; // ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ğ³ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ñ†ĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ… Ğ¾Ğ±ÑŠĞµĞ¼Ğ¾Ğ²
        }
        
        function getCountryMultiplier() {
            if (selectedCountries.length === 0) return 1.0;
            
            const avgTier = selectedCountries.reduce((sum, country) => {
                // ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ°Ğº Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ğµ, Ñ‚Ğ°Ğº Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¾Ğ²Ñ‹Ğµ Ñ‚Ğ¸Ñ€Ñ‹
                if (country.tier === 'difficult') return sum + 4; // ĞŸÑ€Ğ¸ÑĞ²Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½
                return sum + parseInt(country.tier);
            }, 0) / selectedCountries.length;
            
            const tier = Math.round(avgTier);
            
            // ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ´Ğ»Ñ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¸Ñ€Ğ¾Ğ²
            if (tier === 4) return COUNTRY_MULTIPLIERS['difficult']; // Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹
            return COUNTRY_MULTIPLIERS[tier] || 1.0;
        }
        
        function getMarketDiscount(views) {
            const sortedDiscounts = Object.entries(MARKET_DISCOUNTS).sort((a, b) => parseInt(b[0]) - parseInt(a[0]));
            for (const [minViews, discount] of sortedDiscounts) {
                if (views >= parseInt(minViews)) {
                    return discount;
                }
            }
            return 0;
        }
        
        function getPlatformMultiplier() {
            let multiplier = 1.0;
            
            if (document.getElementById('platform_youtube_shorts').checked) {
                multiplier = 1.15; // YouTube Shorts +15%
            }
            
            return multiplier;
        }
        
        function calculateDiscounts() {
            let totalDiscount = 0;
            let discountList = [];
            
            for (const [key, discount] of Object.entries(DISCOUNTS)) {
                const element = document.getElementById(key);
                if (element && element.checked) {
                    totalDiscount += discount;
                    discountList.push(`<div class="d-flex justify-content-between"><span>${getDiscountName(key)}</span><span class="text-success">-${discount}%</span></div>`);
                }
            }
            
            const vipDiscount = parseFloat(document.getElementById('vip_discount').value) || 0;
            if (vipDiscount > 0) {
                totalDiscount += vipDiscount;
                discountList.push(`<div class="d-flex justify-content-between"><span>VIP ÑĞºĞ¸Ğ´ĞºĞ°</span><span class="text-success">-${vipDiscount}%</span></div>`);
            }
            
            return { discountPercent: totalDiscount, discountList };
        }
        
        function calculateMarkups() {
            let totalMarkup = 0;
            let markupList = [];
            
            for (const [key, markup] of Object.entries(MARKUPS)) {
                const element = document.getElementById(key);
                if (element && element.checked) {
                    totalMarkup += markup;
                    markupList.push(`<div class="d-flex justify-content-between"><span>${getMarkupName(key)}</span><span class="text-danger">+${markup}%</span></div>`);
                }
            }
            
            return { markupPercent: totalMarkup, markupList };
        }
        
        function getDiscountName(key) {
            const names = {
                'own_badge': 'Ğ¡Ğ²Ğ¾Ğ¹ Ğ±ĞµĞ¹Ğ´Ğ¶',
                'own_content': 'Ğ¡Ğ²Ğ¾Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚',
                'pilot': 'ĞŸĞ¸Ğ»Ğ¾Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚'
            };
            return names[key] || key;
        }
        
        function getMarkupName(key) {
            const names = {
                'urgency': 'Ğ¡Ñ€Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ',
                'peak_season': 'ĞŸĞ¸ĞºĞ¾Ğ²Ñ‹Ğ¹ ÑĞµĞ·Ğ¾Ğ½',
                'exclusive_content': 'Ğ­ĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚'
            };
            return names[key] || key;
        }
        
        function convertCurrency(amount, currency) {
            let symbol = ' â‚½';
            let convertedAmount = amount;
            
            if (currency === 'USD') {
                convertedAmount = amount / usdToRub;
                symbol = ' $';
            } else if (currency === 'EUR') {
                convertedAmount = amount / eurToRub;
                symbol = ' â‚¬';
            }
            
            return { symbol, convertedCost: convertedAmount };
        }
        
        function displayResults(views_mln, basePrice, countryMultiplier, marketDiscount, 
                               platformMultiplier, discountAmount, markupAmount, finalCost, symbol, 
                               discountList, markupList, currency) {
            
            document.getElementById('res_views').textContent = views_mln.toLocaleString('ru-RU') + ' Ğ¼Ğ»Ğ½';
            
            // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ†ĞµĞ½Ñƒ Ğ·Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ² Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ²Ğ°Ğ»ÑÑ‚Ñƒ
            const { symbol: cpvSymbol, convertedCost: cpvCost } = convertCurrency(basePrice, currency);
            document.getElementById('res_cpv').textContent = cpvCost.toFixed(4) + cpvSymbol;
            
            // Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ CPM (Ñ†ĞµĞ½Ğ° Ğ·Ğ° 1000 Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ²)
            const cpm = cpvCost * 1000;
            document.getElementById('res_cpm').textContent = cpm.toFixed(2) + cpvSymbol;
            
            // Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²ÑƒÑ Ñ†ĞµĞ½Ñƒ Ğ·Ğ° 1 Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ ÑĞºĞ¸Ğ´ĞºĞ°Ğ¼Ğ¸ Ğ¸ Ğ½Ğ°Ğ´Ğ±Ğ°Ğ²ĞºĞ°Ğ¼Ğ¸
            const finalCostPerView = finalCost / (views_mln * 1000000);
            document.getElementById('res_cpv_final').textContent = finalCostPerView.toFixed(4) + symbol;
            
            // Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ñ‹Ğ¹ CPM ÑĞ¾ ÑĞºĞ¸Ğ´ĞºĞ°Ğ¼Ğ¸
            const finalCpm = finalCostPerView * 1000;
            document.getElementById('res_cpm_final').textContent = finalCpm.toFixed(2) + symbol;
            
            document.getElementById('res_multiplier').textContent = (countryMultiplier * 100).toFixed(0) + '%';
            document.getElementById('res_market_discount').textContent = marketDiscount + '%';
            
            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¼Ğ½Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹
            if (platformMultiplier > 1.0) {
                document.getElementById('res_platform_multiplier').textContent = '+' + ((platformMultiplier - 1) * 100).toFixed(0) + '%';
                document.getElementById('platform_multiplier_row').style.display = 'block';
            } else {
                document.getElementById('platform_multiplier_row').style.display = 'none';
            }
            
            // ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ ÑÑƒĞ¼Ğ¼Ñ‹ Ğ½Ğ°Ğ´Ğ±Ğ°Ğ²Ğ¾Ğº Ğ¸ ÑĞºĞ¸Ğ´Ğ¾Ğº Ğ² Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ²Ğ°Ğ»ÑÑ‚Ñƒ
            const { symbol: markupSymbol, convertedCost: markupConverted } = convertCurrency(markupAmount, currency);
            const { symbol: discountSymbol, convertedCost: discountConverted } = convertCurrency(discountAmount, currency);
            
            document.getElementById('res_markup_amount').textContent = markupConverted.toFixed(2) + markupSymbol;
            document.getElementById('res_discount_amount').textContent = discountConverted.toFixed(2) + discountSymbol;
            document.getElementById('res_final_cost').textContent = finalCost.toFixed(2) + symbol;
            
            document.getElementById('res_markups').innerHTML = markupList.length > 0 ? markupList.join('') : '<div class="text-muted">ĞĞµÑ‚ Ğ½Ğ°Ğ´Ğ±Ğ°Ğ²Ğ¾Ğº</div>';
            document.getElementById('res_discounts').innerHTML = discountList.length > 0 ? discountList.join('') : '<div class="text-muted">ĞĞµÑ‚ ÑĞºĞ¸Ğ´Ğ¾Ğº</div>';
            
            document.getElementById('resultBlock').style.display = 'block';
        }
        
        function resetForm() {
            document.getElementById('calcForm').reset();
            document.getElementById('views_slider').value = 15;
            document.querySelectorAll('.country-option').forEach(el => el.classList.remove('selected'));
            selectedCountries = [];
            document.getElementById('resultBlock').style.display = 'none';
            calculate();
        }
        
        async function saveCalculation() {
            // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹
            const platforms = [];
            if (document.getElementById('platform_instagram').checked) platforms.push('instagram');
            if (document.getElementById('platform_tiktok').checked) platforms.push('tiktok');
            if (document.getElementById('platform_youtube_shorts').checked) platforms.push('youtube_shorts');
            
            // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ñƒ Ğ´Ğ»Ñ API (Ğ¿ĞµÑ€Ğ²Ğ°Ñ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ)
            const primaryCountry = selectedCountries.length > 0 ? selectedCountries[0].code : 'USA';
            
            const calculationData = {
                volume_millions: parseFloat(document.getElementById('views_mln').value) || 0,
                platform: platforms.length > 0 ? platforms[0] : 'instagram', // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ API
                platforms: platforms, // Ğ’ÑĞµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹
                country: primaryCountry, // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ° Ğ´Ğ»Ñ API
                countries: selectedCountries, // Ğ’ÑĞµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹
                currency: document.getElementById('currency').value,
                own_badge: document.getElementById('own_badge').checked,
                own_content: document.getElementById('own_content').checked,
                pilot: document.getElementById('pilot').checked,
                vip_percent: parseInt(document.getElementById('vip_discount').value) / 100.0 || 0,
                urgent: document.getElementById('urgency').checked,
                peak_season: document.getElementById('peak_season').checked,
                exclusive_content: document.getElementById('exclusive_content').checked,
                notes: 'Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸'
            };
            
            // Ask for client name via modal, then include it in payload
            const modalEl = document.getElementById('clientNameModal');
            const modal = new bootstrap.Modal(modalEl);
            const inputEl = () => document.getElementById('client_name_input');
            const saveBtn = () => document.getElementById('client_name_save_btn');
            
            const waitForName = () => new Promise(resolve => {
                const handler = async () => {
                    const nameVal = (inputEl().value || '').trim();
                    modal.hide();
                    saveBtn().removeEventListener('click', handler);
                    resolve(nameVal);
                };
                saveBtn().addEventListener('click', handler);
                modal.show();
                inputEl().focus();
            });

            const clientName = await waitForName();
            if (clientName) {
                calculationData.client_name = clientName;
            }

            try {
                const response = await fetch('{% url "cabinet_agency_calc_quote" %}', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify(calculationData)
                });
                
                const result = await response.json();
                if (response.ok) {
                    showNotification('Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½', 'success');
                    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ ÑĞºĞ°Ñ‡Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ
                    if (result.calculation_id) {
                        const downloadBtn = document.getElementById('downloadExcel');
                        downloadBtn.href = `/cabinet/download/calculation/${result.calculation_id}/excel/`;
                        downloadBtn.style.display = 'inline-block';
                        // bind loading indicator
                        if (!downloadBtn.dataset.bound) {
                            downloadBtn.addEventListener('click', function(e){
                                const spinner = this.querySelector('.spinner-border');
                                const label = this.querySelector('.btn-label');
                                if (spinner && label) {
                                    spinner.style.display = 'inline-block';
                                    label.textContent = 'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ¼ Excel...';
                                    // Hide spinner after download starts (best effort)
                                    setTimeout(()=>{
                                        spinner.style.display = 'none';
                                        label.innerHTML = '\\u003ci class="bi bi-file-earmark-excel"\\u003e\\u003c/i\\u003e Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Excel';
                                    }, 6000);
                                }
                            });
                            downloadBtn.dataset.bound = '1';
                        }
                    }
                } else {
                    showNotification('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ: ' + (result.error || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°'), 'error');
                }
            } catch (e) {
                showNotification('ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ', 'error');
            }
        }
        
        function copySummary() {
            const summary = `Ğ Ğ°ÑÑ‡ĞµÑ‚ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ: ${document.getElementById('res_views').textContent} Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¾Ğ², Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: ${document.getElementById('res_final_cost').textContent}`;
            navigator.clipboard.writeText(summary).then(() => {
                showNotification('Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ² Ğ±ÑƒÑ„ĞµÑ€ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°', 'success');
            }).catch(() => {
                showNotification('ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ', 'error');
            });
        }
        
        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} notification`;
            notification.innerHTML = `<strong>${message}</strong>`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
</script>
{% endblock %}
